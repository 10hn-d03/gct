dnl

AC_REVISION($Revision$)
AC_INIT(Makefile.am)

GLOBUS_INIT

AM_PROG_LIBTOOL

dnl config header goes here

dnl Initialize the automake rules the last argument
AM_INIT_AUTOMAKE($GPT_NAME, $GPT_VERSION)

LAC_DOXYGEN("../", "", "$GLOBUS_LOCATION/sbin/globus-vararg-enums-doxygen-filter.pl")

build_prereq="no"
AC_ARG_ENABLE(static-deps,
    AC_HELP_STRING([--enable-static-deps], 
                   [Build and link libnice, glib2, and udt statically]),
    [build_prereq="yes"],
    [build_prereq="no"])

if test "$build_prereq" = "yes" ; then
    export GLOBUS_FLAVOR=$GLOBUS_FLAVOR_NAME
    cd prereq
    if test ! -f done; then
        sh ./build.sh
    fi
    cd ..
    
fi

if test -z "$GPT_IGNORE_DEPS"; then
    if test "$build_prereq" = "yes" ; then
        export PKG_CONFIG_PATH="$PWD/prereq/inst/lib/pkgconfig:$PKG_CONFIG_PATH"
        PKG_PROG_PKG_CONFIG
        PKG_CONFIG="$PKG_CONFIG --static"
        UDT_LIBS="-L$PWD/prereq/inst/lib -ludt"
        UDT_CFLAGS="-I$PWD/prereq/inst/include"
    else
        PKG_PROG_PKG_CONFIG
        UDT_LIBS="-ludt"
        UDT_CFLAGS=""
    fi
   
    PKG_CHECK_MODULES([NICE], [nice >= 0.1])
    PKG_CHECK_MODULES([GLIB], [glib-2.0 >= 2.32 gthread-2.0 gio-2.0 gobject-2.0])
fi

AC_SUBST(NICE_LIBS)
AC_SUBST(NICE_CFLAGS)
AC_SUBST(GLIB_LIBS)
AC_SUBST(GLIB_CFLAGS)
AC_SUBST(UDT_LIBS)
AC_SUBST(UDT_CFLAGS)

GLOBUS_FINALIZE

AC_OUTPUT(
	Makefile
	pkgdata/Makefile
        doxygen/Makefile
        doxygen/Doxyfile 
        doxygen/Doxyfile-internal
	pkgdata/pkg_data_src.gpt
        version.h
)

