<project name="UDPUsage" default="compile" basedir=".">

  <path id="lib.classpath">
    <fileset dir="./lib/">
      <include name="**/*.jar"/>
    </fileset>
  </path>

  <target name="clean">
    <delete>
      <fileset dir="./dist">
	<include name="**/*.class"/>
      </fileset>
      <fileset dir=".">
	<include name="*.jar"/>
      </fileset>
    </delete>

  </target>

  <target name="compile" depends="clean">
    <mkdir dir="./dist"/>
    <javac srcdir="./src/" destdir="./dist/">
      <classpath>
	<path refid="lib.classpath"/>
      </classpath>
    </javac>
    <jar destfile = "UDPSender.jar">
      <fileset dir="./dist/">
	<include name="UsageMonitorPacket.class"/>
	<include name="IPTimeMonitorPacket.class"/>
	<include name="GFTPMonitorPacket.class"/>
	<include name="ExampleGFTPSender.class"/>
      </fileset>
      <fileset file="./udpUsage.properties"/>
      <fileset file="./log4j.properties"/>
    </jar>
    <jar destfile = "UDPReceiver.jar">
      <fileset dir="./dist/">
        <include name="DefaultPacketHandler.java"/>
        <include name="GFTPMonitorPacket.java"/>
        <include name="GridFTPPacketHandler.java"/>
        <include name="IPTimeMonitorPacket.java"/>
        <include name="PacketHandler.java"/>
        <include name="Receiver.java"/>
        <include name="ReceiverExample.java"/>
        <include name="RingBuffer.java"/>
        <include name="UsageMonitorPacket.java"/>
      </fileset>
      <fileset file="./udpUsage.properties"/>
      <fileset file="./log4j.properties"/>
    </jar>
  </target>

  <target name="run-receiver" depends="compile">
    <java classname="org.globus.usage.ReceiverExample" fork="true">
      <classpath>
	<pathelement location="./Usage_UDPReceiver.jar"/>
	<path refid="lib.classpath"/>
      </classpath>
    </java>
  </target>

  <target name="run-sender" depends="compile">
    <java classname="org.globus.usage.ExampleGFTPSender">
      <classpath>
	<pathelement location="./Usage_UDPSender.jar"/>
        <path refid="lib.classpath"/>
      </classpath>
    </java>
  </target>

<!--
  <target name="do-junit-tests">
    <path id="junit.classpath">
      <fileset dir="/home/jdicarlo/java-software/junit3.8.1/">
	<include name="**/*.jar"/>
      </fileset>
    </path>

    <mkdir dir="./dist"/>
    <javac srcdir="." destdir="./dist/" includes = "src/**, tests/**">
      <classpath>
	<path refid="junit.classpath"/>
      </classpath>
    </javac>

    <java classname="junit.textui.TestRunner">
      <classpath>
	<pathelement path="./dist"/>
	<path refid="junit.classpath"/>
      </classpath>
      <arg value="UnitTester"/>
    </java>
  </target> -->

</project>