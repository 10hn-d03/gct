dnl

AC_REVISION($Revision$)
AC_INIT(Makefile.am)

AC_ARG_WITH(flavor,
	[ --with-flavor=<FL>     Specify the globus build flavor  ],

	[
	case $withval in
	no)
		echo "Please specify a globus build flavor" >&2
		exit 1
		;;
	yes)
		echo "Please specify a globus build flavor" >&2
		exit 1
		;;
	*)
		FL=$withval
		;;
	esac
	],

	[ 
	echo "Please specify a globus build flavor" >&2
	exit 1
	]
)

AC_SUBST(FL)

# checking for the GLOBUS_INSTALL_PATH

if test "x$GLOBUS_INSTALL_PATH" = "x"; then
    echo "ERROR Please specify GLOBUS_INSTALL_PATH" >&2
    exit 1
fi

# get the environment scripts
#. $GLOBUS_INSTALL_PATH/etc/globus-sh-tools.sh

. $GLOBUS_INSTALL_PATH/etc/globus-build-env-$FL.sh

prefix='$(GLOBUS_INSTALL_PATH)'
exec_prefix='$(GLOBUS_INSTALL_PATH)'


dnl config header goes here

dnl Need to fix a bug in AM_INIT_AUTOMAKE
AC_PROG_CC

dnl Initialize the automake rules the last argument
AM_INIT_AUTOMAKE(globus_common, 2.0.0)

dnl Configure a libtool script for the distribution
AM_PROG_LIBTOOL

dnl Set up conditionals for thread building.
AM_CONDITIONAL(USE_NO_THREADS, test "$GLOBUS_THREADS" = "none")
AM_CONDITIONAL(USE_PTHREADS, test "$GLOBUS_THREADS" = "pthreads")
AM_CONDITIONAL(USE_SOLARIS_THREADS, test "$GLOBUS_THREADS" = "solaristhreads")
AM_CONDITIONAL(USE_SPROC_THREADS, test "$GLOBUS_THREADS" = "sproc")

dnl Determine thread library flags
LAC_THREADS

AC_SUBST(GLOBUS_THREADS)

AC_OUTPUT(
	Makefile
	globus_common_$FL.gpd:globus_common.gpd.in
	library/globus_common.h
	library/Makefile
	tests/run-tests
	tests/Makefile
)

