#! @SH@

# This is a simple shell script that acts like 
# the hostname command.  But is returns the FQN
# in all cases.

PROGRAM_NAME=`echo $0 | ${GLOBUS_SH_SED-sed} -e 's|.*/||g'`
PROGRAM_VERSION=`echo '$Revision$' | ${GLOBUS_SH_CUT-cut} -d' ' -f2`

short_usage="${PROGRAM_NAME} [-help] [-version]"

long_usage()
{
   ${GLOBUS_SH_CAT-cat} 1>&2 <<EOF

${short_usage}

    globus-domainname tries to return the system domainname 

    Setting the environment variable GLOBUS_HOSTNAME will cause
    globus-domainname to return a value based on this variable. 
    This is useful for specifying the use of certain network 
    interfaces when communicating etc.

EOF
}

# Inserted by configure.
@globus_script_initializer@
@globus_args_parser_header@

if [ -n "$1" ]; then
    globus_args_unrecognized_option "$1"
fi
 
globus_hostname=""		# Replaced by deploy

globus_domainname="`echo ${globus_hostname}|${GLOBUS_SH_CUT-cut} -s -d '.' -f '2-'`"

if [ -n "${globus_domainname}" ]; then
    echo "${globus_domainname}"
    exit 0
fi

LOCALDOMAIN=@LOCALDOMAIN@
 
if [ -x ${libexecdir}/globus-libc-hostname ]; then
    FULLNAME="`${libexecdir}/globus-libc-hostname`"
    # make sure command ran successfully
    if [ ! $? = 0 ]
    then
       FULLNAME=`@GLOBUS_SH_HOSTNAME@`
    fi
else
    FULLNAME=`@GLOBUS_SH_HOSTNAME@`
fi
    BASENAME=`@GLOBUS_SH_HOSTNAME@ | ${GLOBUS_SH_CUT-cut} -d. -f1`
 
if [ "X$FULLNAME" = "X$BASENAME" ] ; then
# Its not fully qualified
    GLOBUS_HOSTNAME="${BASENAME}.${LOCALDOMAIN}"
else
    GLOBUS_HOSTNAME="$FULLNAME"
fi

GLOBUS_DOMAINNAME="`echo $GLOBUS_HOSTNAME | ${GLOBUS_SH_TR-tr} 'A-Z' 'a-z' | ${GLOBUS_SH_CUT-cut} -s -d '.' -f '2-'`"

echo $GLOBUS_DOMAINNAME
export GLOBUS_DOMAINNAME
