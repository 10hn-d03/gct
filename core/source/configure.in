AC_REVISION($Revision$)
AC_INIT(Makefile.am)
AC_CONFIG_AUX_DIR(config)
AM_INIT_AUTOMAKE(,0)
AM_CONFIG_HEADER(globus_config.h)

LAC_COMPILERS_ARGS

AC_ARG_WITH(
    flavor,
    [  --with-flavor                 Globus flavor string],
    [globus_cv_flavor="$withval"],
    [globus_cv_flavor="notset"])

if test "$globus_cv_flavor" = "notset" \
     -o "$globus_cv_flavor" = "no" \
     -o "$globus_cv_flavor" = "yes" ; then
    AC_MSG_ERROR([A flavor description string must be specified!])
fi

GLOBUS_FLAVOR_NAME=$globus_cv_flavor
AC_SUBST(GLOBUS_FLAVOR_NAME)

dnl
dnl Gather information about our build environment
dnl
dnl NOTE: this needs to be done before AM_PROG_LIBTOOL is called
dnl
LAC_COMPILERS_TARGET(no)

dnl
dnl
dnl
save_LD=$LD
LD=
AM_PROG_LIBTOOL
mv ./libtool libtool-$GLOBUS_FLAVOR_NAME
LD=$save_LD

dnl
dnl Output selected thread package
dnl
GLOBUS_THREADS=$lac_cv_threads_type
if test "$GLOBUS_THREADS" = "no" ; then
    GLOBUS_THREADS=none
fi
AC_SUBST(GLOBUS_THREADS)

# checking for the GLOBUS_INSTALL_PATH

if test "x$GLOBUS_INSTALL_PATH" = "x"; then
    echo "ERROR Please specify GLOBUS_INSTALL_PATH" >&2
    exit 1
fi

prefix='$(GLOBUS_INSTALL_PATH)'
exec_prefix='$(GLOBUS_INSTALL_PATH)'


AC_OUTPUT(Makefile
       	globus-build-env-${globus_cv_flavor}.sh:globus-build-env.sh.in
	globus-sh-tools.sh
	aclocal/Makefile)
